---
  - name: installing mandatory OS packages
    apt:
      name=software-properties-common
      state=present

  - name: adding SignalFX apt-repository
    apt_repository:
      repo='ppa:signalfx/collectd-release'

  - name: install package
    become: true
    apt:
      name=collectd
      state=present
      update_cache=yes

  - name: setting up config dir
    become: true
    file:
      path=/etc/collectd.d/managed_config
      state=directory

  - name: placing config files
    become: true
    copy:
      src=10-aggregation-cpu.conf
      dest=/etc/collectd.d/managed_config/10-aggregation-cpu.conf
